<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>å•†å“åˆ—è¡¨</title>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
      margin: 20px;
    }

    .categories {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .category-btn {
      padding: 6px 14px;
      border-radius: 20px;
      border: 1px solid #ddd;
      cursor: pointer;
      background: #fff;
    }

    .category-btn.active {
      background: #000;
      color: #fff;
      border-color: #000;
    }

    .products {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 16px;
    }

    .product {
      border: 1px solid #eee;
      padding: 12px;
      border-radius: 8px;
      display: flex;
      flex-direction: column;
    }

    .product img {
      width: 100%;
      height: 140px;
      object-fit: cover;
      border-radius: 6px;
    }

    .price {
      font-weight: bold;
      margin-top: 6px;
      color: #e11d48;
    }

    /* æ–°å¢åº“å­˜æ ·å¼ */
    .stock {
      font-size: 0.85em;
      margin-top: 4px;
    }
    .stock-in { color: #16a34a; } /* æœ‰è´§ç»¿è‰² */
    .stock-out { color: #dc2626; font-weight: bold; } /* æ²¡è´§çº¢è‰² */
    
    .view-detail {
      margin-top: 10px;
      text-align: center;
      background: #f4f4f5;
      padding: 6px;
      border-radius: 4px;
      text-decoration: none;
      color: #333;
      font-size: 0.9em;
    }
  </style>
</head>
<body>

<h1>ğŸ›’ å•†å“åˆ—è¡¨</h1>

<div id="categories" class="categories"></div>
<div id="products" class="products"></div>

<script>
let allProducts = []
let currentCategory = 'å…¨éƒ¨'

fetch('/api/products')
  .then(res => res.json())
  .then(data => {
    allProducts = data
    renderCategories()
    renderProducts()
  })

function renderCategories() {
  const container = document.getElementById('categories')
  container.innerHTML = ''

  const categories = ['å…¨éƒ¨', ...new Set(
    allProducts
      .map(p => p.category)
      .filter(Boolean)
  )]

  categories.forEach(cat => {
    const btn = document.createElement('button')
    btn.className = 'category-btn' + (cat === currentCategory ? ' active' : '')
    btn.textContent = cat
    btn.onclick = () => {
      currentCategory = cat
      renderCategories()
      renderProducts()
    }
    container.appendChild(btn)
  })
}

function renderProducts() {
  const container = document.getElementById('products')
  container.innerHTML = ''

  const filtered = currentCategory === 'å…¨éƒ¨'
    ? allProducts
    : allProducts.filter(p => p.category === currentCategory)

  if (filtered.length === 0) {
    container.innerHTML = '<p>è¯¥åˆ†ç±»æš‚æ— å•†å“</p>'
    return
  }

  filtered.forEach(p => {
    const div = document.createElement('div')
    div.className = 'product'
    
    // åˆ¤æ–­åº“å­˜çŠ¶æ€
    const stockHTML = p.stock > 0 
      ? `<div class="stock stock-in">åº“å­˜: ${p.stock}</div>` 
      : `<div class="stock stock-out">å·²å”®ç½„</div>`;

    div.innerHTML = `
      <img src="${p.image_url || 'https://via.placeholder.com/200'}" />
      <h3 style="margin: 8px 0 4px 0; font-size: 1.1em;">${p.name}</h3>
      <div class="price">${p.currency} ${p.price}</div>
      ${stockHTML}
      <a class="view-detail" href="product.html?id=${p.id}">æŸ¥çœ‹è¯¦æƒ…</a>
    `
    container.appendChild(div)
  })
}
</script>

</body>
</html>