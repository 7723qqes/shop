<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç‰©å“è¯¦æƒ…</title>
  <style>
    :root {
      --primary: #2563eb;
      --bg: #f3f4f6;
      --text: #1f2937;
    }
    body {
      font-family: -apple-system, system-ui, sans-serif;
      background: var(--bg);
      margin: 0;
      color: var(--text);
    }
    
    .container {
      max-width: 600px;
      margin: 0 auto;
      background: #fff;
      min-height: 100vh;
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
    }
    
    /* è¯¦æƒ…å¤§å›¾ */
    .viewer {
      width: 100%;
      aspect-ratio: 1/1;
      background: #f9fafb;
      display: flex;
      align-items: center;
      justify-content: center;
      border-bottom: 1px solid #eee;
    }
    .viewer img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .content {
      padding: 25px 20px 120px;
    }
    .price {
      font-size: 2.2rem;
      font-weight: 800;
      color: #dc2626;
      margin-bottom: 10px;
    }
    .title {
      font-size: 1.5rem;
      font-weight: 700;
      margin: 0 0 20px 0;
      line-height: 1.3;
    }
    
    .tags-row {
      display: flex;
      gap: 10px;
      margin-bottom: 30px;
    }
    .tag {
      padding: 6px 14px;
      border-radius: 8px;
      background: #f3f4f6;
      font-size: 0.9rem;
      font-weight: 600;
      color: #6b7280;
    }

    .description-box {
      border-top: 1px solid #eee;
      padding-top: 25px;
    }
    .desc-label {
      font-size: 0.8rem;
      font-weight: 700;
      color: #9ca3af;
      text-transform: uppercase;
      margin-bottom: 12px;
      display: block;
    }
    .desc-text {
      font-size: 1.05rem;
      line-height: 1.8;
      color: #4b5563;
      white-space: pre-wrap;
    }

    /* æ‚¬æµ®æŒ‰é’®ç»„ï¼šåŠ å¤§é—´è·é˜²è¯¯è§¦ */
    .fab-group {
      position: fixed;
      right: 20px;
      bottom: 30px;
      display: flex;
      flex-direction: column;
      gap: 18px;
      z-index: 100;
    }
    .fab {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: #fff;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      text-decoration: none;
      font-size: 24px;
      transition: background 0.2s;
    }
    .fab:active { background: #f9fafb; transform: scale(0.95); }

    /* å¤åˆ¶æˆåŠŸæç¤º */
    .toast {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 10px 24px;
      border-radius: 30px;
      font-size: 14px;
      display: none;
      z-index: 1000;
    }
  </style>
</head>
<body>

<div id="toast" class="toast">é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿</div>

<div class="container" id="app">
  <div style="padding: 100px; text-align: center; color: #999;">è¯»å–ä¸­...</div>
</div>

<div class="fab-group">
  <a href="index.html" class="fab">ğŸ </a>
  <div class="fab" onclick="copyItemLink()" title="åˆ†äº«ç‰©å“">ğŸ”—</div>
  <div class="fab" onclick="window.scrollTo({top:0, behavior:'smooth'})">â†‘</div>
</div>

<script>
  const urlParams = new URLSearchParams(location.search);
  const productId = urlParams.get("id");

  if (!productId) {
    document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">å‚æ•°é”™è¯¯</div>';
  } else {
    fetch(`/api/products?id=${productId}&t=${Date.now()}`)
      .then(res => res.json())
      .then(data => {
        const p = data[0];
        if (!p) {
          document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">ç‰©å“ä¸å­˜åœ¨</div>';
          return;
        }

        const imgList = (p.image_url || "").split(',').map(u => u.trim()).filter(Boolean);
        
        document.getElementById('app').innerHTML = `
          <div class="viewer">
            <img src="${imgList[0] || 'https://via.placeholder.com/400?text=No+Image'}" alt="${p.name}">
          </div>
          <div class="content">
            <div class="price">${p.currency || 'Â¥'}${p.price}</div>
            <h1 class="title">${p.name}</h1>
            <div class="tags-row">
              <span class="tag">${p.category || 'æœªåˆ†ç±»'}</span>
              <span class="tag">åº“å­˜: ${p.stock}</span>
            </div>
            <div class="description-box">
              <span class="desc-label">è¯¦ç»†ä»‹ç»</span>
              <div class="desc-text">${p.description || "æš‚æ— æè¿°"}</div>
            </div>
          </div>
        `;
      })
      .catch(() => {
        document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">åŠ è½½å¤±è´¥</div>';
      });
  }

  function copyItemLink() {
    navigator.clipboard.writeText(window.location.href).then(() => {
      const toast = document.getElementById('toast');
      toast.style.display = 'block';
      setTimeout(() => { toast.style.display = 'none'; }, 2000);
    }).catch(err => {
      alert("å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æµè§ˆå™¨åœ°å€");
    });
  }
</script>
</body>
</html>