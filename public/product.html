<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Áâ©ÂìÅËØ¶ÊÉÖ</title>
    <style>
        :root { --primary: #2563eb; --bg: #ffffff; --text: #1e293b; --sub: #64748b; }
        body { font-family: -apple-system, system-ui, sans-serif; background: #f8fafc; margin: 0; color: var(--text); }
        .container { max-width: 600px; margin: 0 auto; background: #fff; min-height: 100vh; position: relative; box-shadow: 0 0 40px rgba(0,0,0,0.03); }
        
        .back-nav { position: absolute; top: 20px; left: 20px; z-index: 100; }
        .back-btn { background: rgba(255,255,255,0.7); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); padding: 10px 20px; border-radius: 25px; text-decoration: none; color: #000; font-size: 14px; font-weight: 700; display: flex; align-items: center; box-shadow: 0 4px 15px rgba(0,0,0,0.08); }

        .slider { width: 100%; aspect-ratio: 1/1; position: relative; overflow: hidden; background: #f1f5f9; }
        .slider-track { display: flex; transition: transform 0.6s cubic-bezier(0.23, 1, 0.32, 1); height: 100%; }
        .slider-item { min-width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; }
        .slider-item img { width: 100%; height: 100%; object-fit: contain; cursor: zoom-in; }

        .error-state { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #94a3b8; }
        .error-state svg { width: 60px; height: 60px; margin-bottom: 10px; opacity: 0.3; }

        .dots { position: absolute; bottom: 20px; width: 100%; display: flex; justify-content: center; gap: 8px; }
        .dot { width: 8px; height: 8px; border-radius: 4px; background: rgba(0,0,0,0.1); transition: 0.3s; cursor: pointer; }
        .dot.active { background: var(--primary); width: 24px; }

        .content { padding: 35px 25px; animation: fadeInUp 0.6s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .price { font-size: 2.8rem; font-weight: 900; color: #e11d48; margin-bottom: 10px; }
        .title { font-size: 1.6rem; font-weight: 800; margin: 0 0 25px 0; color: #0f172a; }
        .tag-row { display: flex; gap: 12px; margin-bottom: 35px; }
        .tag { padding: 8px 18px; background: #eff6ff; border-radius: 12px; font-size: 1rem; color: var(--primary); font-weight: 700; border: 1px solid rgba(37,99,235,0.1); }

        .desc-section { border-top: 1px solid #f1f5f9; padding-top: 30px; }
        .desc-text { font-size: 1.15rem; line-height: 1.8; color: #334155; white-space: pre-wrap; }

        #gallery { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; z-index: 2000; overflow: hidden; cursor: grab; }
        #galImg { position: absolute; left: 50%; top: 50%; transform: translate(-50%, -50%); transition: transform 0.1s ease-out; user-select: none; }
        .gal-close { position: fixed; top: 30px; right: 30px; color: #fff; font-size: 40px; cursor: pointer; z-index: 2100; }
        .fab-group { position: fixed; right: 25px; bottom: 40px; display: flex; flex-direction: column; gap: 15px; }
        .fab { width: 50px; height: 50px; border-radius: 50%; background: #fff; box-shadow: 0 8px 20px rgba(0,0,0,0.1); display: flex; align-items: center; justify-content: center; cursor: pointer; }
    </style>
</head>
<body>
    <div id="gallery"><span class="gal-close" onclick="closeGal()">√ó</span><img id="galImg" draggable="false"></div>
    <div class="container">
        <nav class="back-nav"><a href="index.html" class="back-btn">‚¨Ö ËøîÂõû</a></nav>
        <div class="slider" id="slider">
            <div id="track" class="slider-track"></div>
            <div id="dots" class="dots"></div>
        </div>
        <div id="app" class="content">Ê≠£Âú®Âä†ËΩΩÂïÜÂìÅËØ¶ÊÉÖ...</div>
    </div>
    <div class="fab-group">
        <div class="fab" onclick="copyLink()">üîó</div>
        <div class="fab" onclick="window.scrollTo({top:0, behavior:'smooth'})">‚ñ≤</div>
    </div>

    <script>
        const pid = new URLSearchParams(location.search).get("id");
        let currentIdx = 0, imgs = [];

        const errorPlaceholder = `
            <div class="error-state">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6v12a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" /></svg>
                <span style="font-size:14px;font-weight:600">ÊöÇÊó†ÂõæÁâá</span>
            </div>`;

        function handleImgError(img) {
            img.parentElement.innerHTML = errorPlaceholder;
        }

        async function load() {
            const cached = localStorage.getItem('inventory_cache');
            if (cached) {
                const data = JSON.parse(cached);
                const p = data.find(item => item.id == pid);
                if (p) renderProduct(p);
            }
            try {
                const res = await fetch(`/api/products?id=${pid}&t=${Date.now()}`);
                const data = await res.json();
                if(data[0]) renderProduct(data[0]);
            } catch(e) { console.log("ÂêåÊ≠•Â§±Ë¥•"); }
        }

        function renderProduct(p) {
            imgs = (p.image_url || "").split(',').map(u => u.trim()).filter(Boolean);
            
            document.getElementById('track').innerHTML = (imgs.length ? imgs : [""]).map(url => `
                <div class="slider-item">
                    ${url ? `<img src="${url}" onerror="handleImgError(this)" onclick="openGal('${url}')">` : errorPlaceholder}
                </div>`).join('');
            
            document.getElementById('dots').innerHTML = imgs.length > 1 ? imgs.map((_, i) => `<div class="dot ${i===currentIdx?'active':''}" onclick="goToSlide(${i})"></div>`).join('') : '';
            
            const stock = Number(p.stock) || 0;
            let stockStyle = "background:#ecfdf5; color:#10b981;", stockLabel = `Â∫ìÂ≠ò: ${stock} (ÂÖÖË∂≥)`;
            if (stock <= 2) { stockStyle = "background:#fffbeb; color:#f59e0b;"; stockLabel = `Â∫ìÂ≠ò: ${stock} (Á¥ßÂº†)`; }
            if (stock === 0) { stockStyle = "background:#fef2f2; color:#e11d48;"; stockLabel = `Â∫ìÂ≠ò: Áº∫Ë¥ß`; }

            document.getElementById('app').innerHTML = `
                <div class="price">¬•${p.price}</div>
                <h1 class="title">${p.name}</h1>
                <div class="tag-row">
                    <span class="tag">${p.category||'Êú™ÂàÜÁ±ª'}</span>
                    <span class="tag" style="${stockStyle}">${stockLabel}</span>
                </div>
                <div class="desc-section">
                    <span style="font-size:0.9rem;font-weight:800;color:#94a3b8;margin-bottom:15px;display:block;">ËØ¶ÁªÜ‰ªãÁªç</span>
                    <div class="desc-text">${p.description||"ÊöÇÊó†ÊèèËø∞"}</div>
                </div>
            `;
        }

        function moveSlider() {
            document.getElementById('track').style.transform = `translateX(-${currentIdx * 100}%)`;
            document.querySelectorAll('.dot').forEach((d, i) => d.classList.toggle('active', i === currentIdx));
        }
        function goToSlide(idx) { currentIdx = idx; moveSlider(); }
        function openGal(url) { document.getElementById('galImg').src = url; document.getElementById('gallery').style.display = 'block'; }
        function closeGal() { document.getElementById('gallery').style.display = 'none'; }
        function copyLink() { navigator.clipboard.writeText(window.location.href); alert("ÈìæÊé•Â∑≤Â§çÂà∂"); }

        load();
    </script>
</body>
</html>