<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ç‰©å“è¯¦æƒ… - ç‰©å“æ¸…å•</title>
  <style>
    :root {
      --primary: #2563eb; /* ç»Ÿä¸€ä½¿ç”¨æ¸…å•è“ */
      --bg: #f3f4f6;    /* æµ…ç°åº•è‰²ï¼Œä¸ä¸»é¡µä¸€è‡´ */
      --text-main: #1f2937;
      --text-sub: #6b7280;
      --card: #ffffff;
    }

    body {
      font-family: -apple-system, system-ui, sans-serif;
      margin: 0;
      background-color: var(--bg);
      color: var(--text-main);
      line-height: 1.6;
    }

    /* æ•´ä½“å®¹å™¨ï¼šç™½è‰²å¡ç‰‡æ•ˆæœ */
    .container {
      max-width: 600px;
      margin: 0 auto;
      min-height: 100vh;
      background: var(--card);
      box-shadow: 0 0 20px rgba(0,0,0,0.05);
      display: flex;
      flex-direction: column;
    }

    /* å›¾ç‰‡å±•ç¤ºåŒº */
    .viewer {
      width: 100%;
      aspect-ratio: 1/1;
      background: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
      border-bottom: 1px solid #f3f4f6;
    }
    .viewer img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      transition: opacity 0.3s ease;
    }
    
    /* ç¼©ç•¥å›¾æ¨ªæ¡ */
    .thumbs-nav {
      padding: 15px;
      display: flex;
      gap: 10px;
      overflow-x: auto;
      scrollbar-width: none;
    }
    .thumbs-nav::-webkit-scrollbar { display: none; }
    .thumb {
      width: 60px;
      height: 60px;
      border-radius: 8px;
      object-fit: cover;
      cursor: pointer;
      border: 2px solid transparent;
      background: #f9fafb;
      flex-shrink: 0;
    }
    .thumb.active {
      border-color: var(--primary);
    }

    /* ä¿¡æ¯åŒºåŸŸ */
    .content {
      padding: 20px 24px 100px;
    }
    .price {
      font-size: 2rem;
      font-weight: 800;
      color: #dc2626; /* ä»·æ ¼ä½¿ç”¨æ˜¾çœ¼çš„çº¢è‰² */
      margin-bottom: 10px;
    }
    .title {
      font-size: 1.4rem;
      font-weight: 700;
      margin: 0 0 15px 0;
      line-height: 1.3;
    }

    /* æ ‡ç­¾è¡Œ */
    .meta-tags {
      display: flex;
      gap: 8px;
      margin-bottom: 25px;
    }
    .tag {
      padding: 4px 12px;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      background: #f3f4f6;
      color: var(--text-sub);
    }
    .tag.stock {
      background: #dcfce7;
      color: #16a34a;
    }
    .tag.out {
      background: #fee2e2;
      color: #dc2626;
    }

    /* æè¿°åŒº */
    .desc-section {
      border-top: 1px solid #f3f4f6;
      padding-top: 20px;
    }
    .desc-label {
      font-size: 0.8rem;
      font-weight: 700;
      color: var(--text-sub);
      text-transform: uppercase;
      margin-bottom: 10px;
      display: block;
    }
    .desc-text {
      font-size: 1rem;
      white-space: pre-wrap;
      color: #4b5563;
    }

    /* å³ä¸‹è§’æµ®åŠ¨æŒ‰é’® */
    .fab-group {
      position: fixed;
      right: 20px;
      bottom: 30px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      z-index: 100;
    }
    .fab {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      background: #fff;
      border: 1px solid #e5e7eb;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      justify-content: center;
      text-decoration: none;
      font-size: 20px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<div class="container" id="app">
  <div style="padding: 100px; text-align: center; color: #999;">æ­£åœ¨è·å–ç‰©å“è¯¦æƒ…...</div>
</div>

<div class="fab-group">
  <a href="index.html" class="fab" title="è¿”å›æ¸…å•">ğŸ </a>
  <div class="fab" onclick="window.scrollTo({top:0, behavior:'smooth'})">â†‘</div>
</div>

<script>
  const params = new URLSearchParams(location.search);
  const id = params.get("id");

  if (!id) {
    document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">æœªæä¾›ç‰©å“ID</div>';
  } else {
    // å¼ºåˆ¶ä¸ä½¿ç”¨ç¼“å­˜æ‹‰å–æœ€æ–°æ•°æ®
    fetch(`/api/products?id=${id}&t=${Date.now()}`)
      .then(res => res.json())
      .then(data => {
        const item = data[0];
        if (!item) {
          document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">è¯¥ç‰©å“å·²ä»æ¸…å•ç§»é™¤</div>';
          return;
        }

        // è§£æå¤šå›¾ï¼šå¤„ç†ç©ºæ ¼ã€æ¢è¡Œã€é€—å·
        const imgList = (item.image_url || "")
          .replace(/\s+/g, '')
          .split(',')
          .filter(u => u.length > 0);
        
        const isOut = item.stock <= 0;

        document.getElementById('app').innerHTML = `
          <div class="viewer">
            <img id="mainView" src="${imgList[0] || 'https://via.placeholder.com/400?text=No+Image'}" alt="${item.name}">
          </div>
          
          ${imgList.length > 1 ? `
            <div class="thumbs-nav">
              ${imgList.map((url, i) => `
                <img class="thumb ${i === 0 ? 'active' : ''}" 
                     src="${url}" 
                     onclick="changePic(this, '${url}')">
              `).join('')}
            </div>
          ` : ''}

          <div class="content">
            <div class="price">${item.currency || '$'}${item.price}</div>
            <h1 class="title">${item.name}</h1>
            
            <div class="meta-tags">
              <span class="tag">${item.category || 'æœªåˆ†ç±»'}</span>
              <span class="tag ${isOut ? 'out' : 'stock'}">
                ${isOut ? 'å·²å”®ç½„' : 'åº“å­˜: ' + item.stock}
              </span>
            </div>

            <div class="desc-section">
              <span class="desc-label">ç‰©å“æè¿°</span>
              <div class="desc-text">${item.description || "æš‚æ— è¯¦ç»†æè¿°ã€‚"}</div>
            </div>
          </div>
        `;
      })
      .catch(err => {
        document.getElementById('app').innerHTML = '<div style="padding:50px;text-align:center;">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
      });
  }

  function changePic(el, url) {
    const main = document.getElementById('mainView');
    main.style.opacity = '0.5';
    setTimeout(() => {
      main.src = url;
      main.style.opacity = '1';
    }, 150);
    document.querySelectorAll('.thumb').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
  }
</script>

</body>
</html>